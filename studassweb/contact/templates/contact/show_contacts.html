{% extends "contact/base.html" %}

{% load i18n %}
{% load bootstrap3 %}
{% load sawp %}

{% block breadcrumb1 %}
    <li class="active">
        {% trans "Contact" %}
    </li>
{% endblock %}

{% block main_content %}
    {% if contacts %}
        {% for contact in contacts %}
            <div class="panel panel-primary">
                <div class="panel-heading">
                    <div class="row inherit-padding-left-right">
                        <div class="pull-left inherit-padding-left-right">
                            <h4>
                                {{ contact.name }}
                            </h4>
                        </div>
                    </div>
                </div>
                <div class="panel-body">
                    {{ contact.info_text | safe }}
                </div>
                <div class="panel-body">
                    <div class="pull-right text-right">
                        {% has_perm "contact" "CAN_EDIT_CONTACT_SETTINGS" as can_edit_contacts %}
                        {% if contact.messages.count > 0 and can_edit_contacts %}
                            {% with contact.unread_messages as unread_messages %}
                                <a href="{% url "contact_view_messages" contact_id=contact.id %}" class="btn btn-primary">
                                    {% trans "View Messages" %}
                                    {% if unread_messages.count > 0 %}
                                        <span class="badge">{{ unread_messages.count }}</span>
                                    {% endif %}
                                </a>
                            {% endwith %}
                        {% endif %}

                        {% if can_edit_contacts %}
                            <a href="{% url "contact_edit" contact_id=contact.id %}" class="btn btn-primary">
                                {% trans "Edit" %}
                            </a>
                        {% endif %}
                        {% if contact.has_recipients %}
                            <a href="{% url "contact_write_message" contact_id=contact.id %}" class="btn btn-primary">
                                {% trans "Send message" %}
                            </a>
                        {% endif %}
                    </div>

                </div>
            </div>
        {% endfor %}
    {% else %}
        <h2>{% trans "No contacts have been added!" %}</h2>
    {% endif %}
{% endblock %}

{% block sidebar %}
    {% has_perm "contact" "CAN_USE_CONTACT_FORM" as can_use_contact_form %}
    {% has_perm "contact" "CAN_EDIT_CONTACT_SETTINGS" as can_edit_contact_settings %}
    <div class="panel panel-primary">
        {% if can_edit_contact_settings %}
            <div class="panel-heading">
                <h2 class="panel-title">{% trans "Actions" %}</h2>
            </div>
            <div class="panel-body">
                <a href="{% url 'contact_create' %}" class="btn btn-primary btn-block">
                    {% trans "Create a new contact" %}
                </a>
            </div>
        {% endif %}
        <div class="panel-heading">
            <h2 class="panel-title" data-toggle="collapse" data-target="#helptext">
                {% trans "Help" %}
                <span class="glyphicon caret pull-right"></span>
            </h2>
        </div>
        <div id="helptext" class="panel-collapse collapse helptext-collapse">
            <div class="panel-body">
                <p>
                    {% if can_use_contact_form %}
                        {% trans "Select who you want to contact!" %}
                    {% else %}
                        {% trans "You do not have permission to use the built-in messaging system." %}
                    {% endif %}
                </p>
                {% load feedback %}
                {% helptext_feedback %}
            </div>
        </div>
    </div>
{% endblock %}