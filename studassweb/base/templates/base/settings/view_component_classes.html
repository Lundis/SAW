{% extends "settings/base.html" %}
{% load sawpanels %}
{% load sidemenu %}
{% load i18n %}
{% load cssmap %}



{% block title %}
    {% trans "View and Edit CSS Classes" %}
{% endblock %}

{% block breadcrumb2 %}
    <li><a href="{{ section.get_absolute_url }}">
        {% trans section.title %}
    </a></li>
{% endblock %}

{% block breadcrumb3 %}
    <li class="active">
        {% trans "Component Classes" %}
    </li>
{% endblock %}

{% block main_content %}
    {% if changed_classes %}
        <h2>{% trans "Components with updated defaults" %}</h2>
        <div class="list-group">
            {% for class in changed_classes %}
                <div class="list-group-item" id="edit-component-{{ class.id }}">
                    <p class="component-description">{% trans class.description %}</p>
                    <input type="text" class="form-control component-value"
                           id="component-input-{{ class.id }}"
                           name="component-{{ class.id }}" value="{{ class.value }}"
                           pattern="[a-zA-Z0-9\- ]*"
                           data-changed="false"
                           maxlength="250"/>
                    <p class="component-default-value">{% trans "Default" %}: {{ class.default }}</p>
                    <div class="mark-as-changed-button" id="mark-as-changed-button-{{ class.id }}">
                        {% trans "Mark as validated" %}
                    </div>
                </div>
            {% endfor %}
        </div>
    {% endif %}

    {% if classes %}

        <h2>{% trans "Components" %}</h2>
        <div class="list-group">
            {% for class in classes %}
                <div class="list-group-item" id="edit-component-{{ class.id }}">
                    <p class="component-description">{% trans class.description %}</p>
                    <input type="text" class="form-control component-value"
                           id="component-input-{{ class.id }}"
                           name="component-{{ class.id }}" value="{{ class.value }}"
                           pattern="[a-zA-Z0-9\- ]*"
                           data-changed="false"
                           maxlength="250"/>
                    <p class="component-default-value {% if class.value == class.default %}invisible{% endif %}"
                       id="component-default-value-{{ class.id }}">
                        {% trans "Default" %}: {{ class.default }}
                    </p>
                </div>
            {% endfor %}
        </div>
    {% endif %}

    <div class="hide">

        <form method="post" action="" id="component-form">
            {% csrf_token %}

        </form>
    </div>

{% endblock %}

{% block sidebar-panel1 %}
    {% sidebarpanel %}
        {% trans "Save" %}
        {% body %}
        <div id="save-button" class="{% get_css "sawbutton_save" %} btn-block">
            {% trans "Save" %}
        </div>

    {% endsidebarpanel %}
{% endblock %}

{% block sidebar-panel-help %}
    {% sidebarpanel "help" %}
        {% trans "Help" %}
        {% body %}
        <p>
            {% trans "This page lets you change what css classes are used for what components on the site" %}.
        </p>
        <p>
            {% trans "Once you change something, the default value will also be shown" %}.
            {% trans "If a default has changed during an update, you will be asked to verify if you still want to keep your change" %}.
        </p>
    {% endsidebarpanel %}
{% endblock %}

{% block scripts %}
    <script>
        $(".mark-as-changed-button").click(function() {
            $(this).addClass("hide");
            var id = this.id.split("-")[4];
            var input_id = "#component-input-" + id;
            $(input_id).attr("data-changed", "true");
        });

        $(".component-value").change(function() {

            var id = this.id.split("-")[2];
            $(this).attr("data-changed", "true");

            $(this).val($(this).val().trim());
            var default_id = "#component-default-value-" + id;
            var default_element = $(default_id);
            var default_value = default_element.html().split(":")[1].trim();
            if ($(this).val() == default_value) {
                default_element.addClass("invisible");
            } else {
                default_element.removeClass("invisible");
            }
        });

        $("#save-button").click(function() {
            // copy input to the form
            $("input[data-changed=true]").each( function(index, element) {
                $("#component-form").append(
                        $("<input />")
                                .attr("name", $(this).attr("name"))
                                .val($(this).val())
                )
            });
            // submit
            $("#component-form").submit();
        });
    </script>
{% endblock %}